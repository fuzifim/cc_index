<?
	if(!empty($channel['info']->getSeo->channel_attribute_value)){
		$seoJson=json_decode($channel['info']->getSeo->channel_attribute_value); 
		if(!empty($seoJson->metaTitle)){
			$metaTitle=$seoJson->metaTitle; 
		}else{
			$metaTitle=$channel['info']->channel_name; 
		}
		if(!empty($seoJson->metaDescription)){
			$metaDescription=$seoJson->metaDescription; 
		}else{
			$metaDescription=$channel['info']->channel_description;
		}
	}else{
		$metaTitle=$channel['info']->channel_name; 
		$metaDescription=$channel['info']->channel_description;
	} 
	$channel['theme']->setTitle(html_entity_decode($metaTitle));
	$channel['theme']->setKeywords(html_entity_decode($metaTitle));
	$channel['theme']->setDescription(str_limit(strip_tags(html_entity_decode($metaDescription),""), $limit = 250, $end='...')); 
	$channel['theme']->setCanonical(route("channel.home",$channel["domainPrimary"]));
	if(!empty($channel['info']->channelAttributeBanner[0]->media->media_name)){$channel['theme']->setImage(config('app.link_media').$channel['info']->channelAttributeBanner[0]->media->media_path.'thumb/'.$channel['info']->channelAttributeBanner[0]->media->media_name);} 
?>
{!!Theme::asset()->container('footer')->usePath()->add('jquery', 'js/jquery-1.11.1.min.js', array('core-script'))!!}
{!!Theme::asset()->container('footer')->usePath()->add('jquery-migrate', 'js/jquery-migrate-1.2.1.min.js', array('core-script'))!!}
{!!Theme::asset()->container('footer')->usePath()->add('bootstrap', 'js/bootstrap.min.js', array('core-script'))!!}
{!!Theme::asset()->container('footer')->usePath()->add('modernizr', 'js/modernizr.min.js', array('core-script'))!!}
{!!Theme::asset()->container('footer')->usePath()->add('toggles', 'js/toggles.min.js', array('core-script'))!!}
{!!Theme::asset()->container('footer')->usePath()->add('jquery.cookies', 'js/jquery.cookies.js', array('core-script'))!!}
{!!Theme::asset()->container('footer')->usePath()->add('jquery.gritter.min', 'js/jquery.gritter.min.js', array('core-script'))!!}
{!!Theme::asset()->container('footer')->usePath()->add('jquery.validate.min', 'js/jquery.validate.min.js', array('core-script'))!!}
{!!Theme::asset()->container('footer')->usePath()->add('swiper.min', 'library/swiper/js/swiper.min.js', array('core-script'))!!}
@if(Auth::check())
	
@endif
@if($channel['security']==true)
	{!!Theme::asset()->add('summernote', 'assets/js/summernote/dist/summernote.css', array('core-style'))!!}
	{!!Theme::asset()->container('footer')->add('summernote', 'assets/js/summernote/dist/summernote.js', array('core-script'))!!}
	{!!Theme::asset()->container('footer')->add('summernote-vi-VN', 'assets/js/summernote/lang/summernote-vi-VN.js', array('core-script'))!!}
	<?
		$dependencies = array(); 
		$channel['theme']->asset()->writeScript('changeChannel','
			jQuery(document).ready(function(){
				"use strict"; 
				$(".groupChannelName").on("click",".btnChannelNameEdit",function() {
					var channelNameText=$(this).parent().closest(".groupChannelName").find(".channelNameText"); 
					var channelDescriptionText=$(this).parent().closest(".groupChannelName").find(".channelDescriptionText"); 
					var changeChannelNameText=$(this).parent().closest(".groupChannelName").find(".changeChannelNameText"); 
					var channelName=$(this).attr("data-name"); 
					var channelDescription=channelDescriptionText.html(); 
					channelNameText.hide(); 
					changeChannelNameText.show(); 
					changeChannelNameText.append("<form id=\"changeChannelName\">"
						+"<div class=\"form-group\">"
							+"<input type=\"phone\" style=\"font-size:18px;\" name=\"channelName\" value=\""+channelName+"\" class=\"form-control\" placeholder=\"Nhập tên công ty, cửa hàng, tên website...\" required />"
							+"<label class=\"error\" for=\"channelName\"></label>"
						+"</div>"
						+"<div class=\"form-group\">"
							+"<textarea name=\"channelDescription\" id=\"summernote\" class=\"form-control\" placeholder=\"Mô tả kênh website...\" required >"+channelDescription+"</textarea>"
							+"<label class=\"error\" for=\"channelDescription\"></label>"
						+"</div>"
						+"<div class=\"form-group\">"
							+"<button type=\"submit\" class=\"btn btn-xs btn-primary btnSaveChannelName\" data-id=\"\"><i class=\"fa fa-check\"></i> Lưu</button> "
							+"<button type=\"button\" class=\"btn btn-xs btn-default btnCancelChannelname\">Hủy</button>"
						+"</div>"
						+"</form>"); 
					var $validator = jQuery(".groupChannelName #changeChannelName").validate({
						highlight: function(element) {
						  jQuery(element).closest(".form-group").removeClass("has-success").addClass("has-error");
						},
						success: function(element) {
						  jQuery(element).closest(".form-group").removeClass("has-error");
						}
					});
					$(".groupChannelName").on("click",".btnSaveChannelName",function() {
						var $valid = jQuery(".groupChannelName #changeChannelName").valid();
						if(!$valid) {
							$validator.focusInvalid();
							return false;
						}else{
							$(".groupChannelName #preloaderInBox").css("display", "block"); 
							var formData = new FormData();
							formData.append("channelName", $(".groupChannelName #changeChannelName input[name=channelName]").val()); 
							formData.append("channelDescription", $(".groupChannelName #changeChannelName textarea[name=channelDescription]").val()); 
							$.ajax({
								url: "'.route("channel.name.save",$channel["domain"]->domain).'",
								headers: {"X-CSRF-TOKEN": $("meta[name=_token]").attr("content")},
								type: "post",
								cache: false,
								contentType: false,
								processData: false,
								data: formData,
								dataType:"json",
								success:function(result){
									$(".groupChannelName #preloaderInBox").css("display", "none"); 
									if(result.success==true){
										jQuery.gritter.add({
											title: "Thông báo!",
											text: result.msg, 
											class_name: "growl-success",
											sticky: false,
											time: ""
										});
										location.reload(); 
									}else{
										jQuery.gritter.add({
											title: "Thông báo!",
											text: result.msg, 
											class_name: "growl-danger",
											sticky: false,
											time: ""
										});
									}
								},
								error: function(result) {
								}
							});
						}
						return false;
					});
					$(".groupChannelName #summernote").summernote(
						{
							popover: {
								image: [
									["custom", ["imageAttributes"]],
									["imagesize", ["imageSize100", "imageSize50", "imageSize25"]],
									["float", ["floatLeft", "floatRight", "floatNone"]],
									["remove", ["removeMedia"]]
								],
							},
							lang: "vi-VN", 
							imageAttributes:{
								imageDialogLayout:"default", // default|horizontal
								icon:"<i class=\"note-icon-pencil\"/>",
								removeEmpty:false // true = remove attributes | false = leave empty if present
							},
							displayFields:{
								imageBasic:true,  // show/hide Title, Source, Alt fields
								imageExtra:false, // show/hide Alt, Class, Style, Role fields
								linkBasic:true,   // show/hide URL and Target fields for link
								linkExtra:false   // show/hide Class, Rel, Role fields for link
							},
							placeholder: "Bạn đang viết gì? ", 
							dialogsInBody: true, 
							focus: true,
							minHeight: 150,   //set editable area"s height 
							enterHtml: "<br>",
							//height:250,
							//minHeight:null,
							//maxHeight:null,
							toolbar: [
								["font", ["bold", "italic", "underline", "clear"]],
							],
							codemirror: { // codemirror options
								theme: "monokai"
							}, 
							callbacks: {
								onImageUpload: function (files){
										uploadImage(files[0]);
								}
							}
					});
					return false;
				}); 
				$(".groupChannelName").on("click",".btnCancelChannelname",function() {
					var channelNameText=$(this).parent().closest(".groupChannelName").find(".channelNameText"); 
					var changeChannelNameText=$(this).parent().closest(".groupChannelName").find(".changeChannelNameText"); 
					channelNameText.show(); 
					changeChannelNameText.empty(); 
				}); 
			}); 
		', $dependencies);
	?>
@endif
<section>
{!!Theme::partial('leftpanel', array('title' => 'Header'))!!}
<div class="mainpanel">
{!!Theme::partial('headerbar', array('title' => 'Header'))!!}
	<div class="pageheader">
		<div class="groupChannelName">
			<div id="preloaderInBox">
				<div id="status"><i class="fa fa-spinner fa-spin"></i></div>
			</div>
			<div class="channelNameText">
				<h1>
					{!!$channel['info']->channel_name!!}
					@if($channel['security']==true)<span><a href="" data-name="{!!$channel['info']->channel_name!!}" class="btnChannelNameEdit"><i class="fa fa-pencil"></i> sửa</a></span>@endif
				</h1>
				<span class="channelDescriptionText">{!!html_entity_decode($channel['info']->channel_description)!!}</span>
			</div>
			<div class="changeChannelNameText"></div>
		</div>
	</div>
	<div class="contentpanel section-content">
		@if($channel['info']->channel_parent_id!=0)
		<div class="form-group mb5">
			@if(!empty($channel['nameFanpageFacebook']))<div class="fb-like" data-href="https://www.facebook.com/{{$channel['nameFanpageFacebook']}}" data-layout="button_count" data-action="like" data-size="small" data-show-faces="true" data-share="false"></div>@endif
			<button type="button" class="btn btn-xs btn-default"><strong class="text-danger"><i class="fa fa-eye"></i> {!!Site::price($channel['info']->channel_view)!!} lượt xem</strong></button>
		</div>
		<div class="section-banner">
			<div class="form-group">
				@if($channel['security']==true)
					<div id="preloaderInBox" style="display:none;">
						<div id="status"><i class="fa fa-spinner fa-spin"></i></div>
					</div>
					<div class="groupChangeBanner" style="position: absolute; overflow: hidden; bottom:5px; right:5px; z-index:999; display:none; ">
						<button type="button" tabindex="500" class="btn btn-xs btn-primary btn-file"><i class="glyphicon glyphicon-camera"></i>&nbsp;  <span>Thêm ảnh bìa</span><input id="changeImageCove" name="changeImageCove" type="file" multiple="" class=""></button>
					</div>
					<?
						$dependencies = array(); 
						$channel['theme']->asset()->writeScript('changeBanner', '
							jQuery(document).ready(function(){
							"use strict"; 
							jQuery(".section-banner").hover(function(){
								var t = jQuery(this);
								t.find(".groupChangeBanner").show(); 
								t.find(".delBannerChannel").show();
								t.find(".btn-file").show();
							}, function() {
								var t = jQuery(this);
								t.find(".groupChangeBanner").hide();
								t.find(".delBannerChannel").hide();
								t.find(".btn-file").hide();
							});
							$("#changeImageCove").bind("change", function(){
								$(".section-banner #preloaderInBox").css("display", "block"); 
								var files = $("#changeImageCove").prop("files")[0];  
								var formData = new FormData();
								formData.append("file", files); 
								formData.append("postType", "banner");  
								$.ajax({
									url: "'.route("channel.upload.file",$channel["domain"]->domain).'",
									type: "post", 
									headers: {"X-CSRF-TOKEN": $("meta[name=_token]").attr("content")},
									cache: false,
									contentType: false,
									processData: false,
									data: formData,
									dataType:"json",
									success:function(result){
										//console.log(result); 
										if(result.success==true){
											var formDataChannel = new FormData();
											formDataChannel.append("channelAttributeType", "banner"); 
											formDataChannel.append("channelAttributeValue", result.id); 
											$.ajax({
												url: "'.route("channel.attribute.media.add",$channel["domain"]->domain).'",
												type: "post", 
												headers: {"X-CSRF-TOKEN": $("meta[name=_token]").attr("content")},
												cache: false,
												contentType: false,
												processData: false,
												data: formDataChannel,
												dataType:"json",
												success:function(resultMedia){
													$(".section-banner #preloaderInBox").css("display", "none"); 
													location.reload(); 
												},
												error: function(resultMedia) { 
													jQuery.gritter.add({
														title: "Thông báo!",
														text: "Lỗi không thể thêm ảnh! ", 
														class_name: "growl-danger",
														sticky: false,
														time: ""
													});
												}
											});
										}else{
											jQuery.gritter.add({
												title: "Thông báo!",
												text: result.msg, 
												class_name: "growl-danger",
												sticky: false,
												time: ""
											});
										}
									},
									error: function(result) { 
										jQuery.gritter.add({
											title: "Thông báo!",
											text: "Lỗi không thể tải ảnh! ", 
											class_name: "growl-danger",
											sticky: false,
											time: ""
										});
									}
								});
							});
							$("#channelBanner").on("click",".delBannerChannel",function() {
								$(".section-banner #preloaderInBox").css("display", "block"); 
								var mediaId= $(this).attr("data-id"); 
								var formData = new FormData();
								formData.append("mediaId", mediaId); 
								formData.append("channelAttributeType", "banner"); 
								$.ajax({
									url: "'.route("channel.attribute.media.delete",$channel["domain"]->domain).'",
									type: "post", 
									headers: {"X-CSRF-TOKEN": $("meta[name=_token]").attr("content")},
									cache: false,
									contentType: false,
									processData: false,
									data: formData,
									dataType:"json",
									success:function(result){
										//console.log(result); 
										if(result.success==true){
											//getChannelAttributeImageCover(); 
											$(".section-banner #preloaderInBox").css("display", "none"); 
											location.reload(); 
										}else{
											jQuery.gritter.add({
												title: "Thông báo!",
												text: result.message, 
												class_name: "growl-danger",
												sticky: false,
												time: ""
											});
										}
									},
									error: function(result) { 
										jQuery.gritter.add({
											title: "Thông báo!",
											text: "Không thể xóa! ", 
											class_name: "growl-danger",
											sticky: false,
											time: ""
										});
									}
								}); 
								return false; 
							});
						});
						', $dependencies);
					?>
				@endif
				@if(count($channel['info']->channelAttributeBanner)<=0)
				<div id="channelBanner" class="swiper-container" style="text-align: center;padding: 60px 0px;border: solid 1px #999;background:#999;">
					<i class="preview glyphicon glyphicon-picture" style="font-size: 180px;color: #666;"></i>
				</div>
				@else
				<div id="channelBanner" class="swiper-container">
					<div class="swiper-wrapper postGallery">
						<? $i=0; ?>
						@foreach($channel['info']->channelAttributeBanner as $banner)
						<? $i++;?>
						<div class="swiper-slide @if($i==1) active @endif">
							@if($channel['security']==true)
								<a href="" class="delBannerChannel"  data-id="{{$banner->media->id}}" style="position:absolute; right:5px; top:5px; display:none;z-index:1;"><span class="label label-danger"><i class="glyphicon glyphicon-trash"></i> Xóa</span></a>
							@endif
							<img class="imageShow img-responsive" src="@if(!empty($banner->media->media_name)){{config('app.link_media').$banner->media->media_path.'thumb/'.$banner->media->media_name}}@endif" url-lg="{{config('app.link_media').$banner->media->media_path.$banner->media->media_name}}" alt="{!!$channel['info']->channel_name!!}">
						</div>
						@endforeach
						
					</div>
					@if(count($channel['info']->channelAttributeBanner)>=2)
					<?
						$dependencies = array(); 
						$channel['theme']->asset()->writeScript('groupCarouselControl', '
							jQuery(document).ready(function(){
							"use strict"; 
							$(".groupCarouselControl").show(); 
						});
						', $dependencies);
					?>
					@else
						<?
							$dependencies = array(); 
							$channel['theme']->asset()->writeScript('groupCarouselControl', '
								jQuery(document).ready(function(){
								"use strict"; 
								$(".groupCarouselControl").hide(); 
							});
							', $dependencies);
						?>
					@endif
					<div class="groupCarouselControl">
						<a class="left carousel-control carousel_control_left" href="#channelBanner" role="button" data-slide="prev">
							<span class="fa fa-chevron-left" aria-hidden="true"></span>
							<span class="sr-only">Previous</span>
						</a>
						<a class="right carousel-control carousel_control_right" href="#channelBanner" role="button" data-slide="next">
							<span class="fa fa-chevron-right" aria-hidden="true"></span>
							<span class="sr-only">Next</span>
						</a>
					</div>
				</div>
				@endif
			</div>
		</div>
		@endif
		@if($channel['info']->channel_parent_id==0)
			<div class="form-group text-center">
				<a href="{{route('post.add',$channel['domainPrimary'])}}" class="btn btn-primary"><i class="glyphicon glyphicon-edit"></i> Đăng tin Cung Cấp</a> <!--<button type="button" class="btn btn-danger" id="btnChannelCreate"><i class="glyphicon glyphicon-plus"></i> Tạo website</button>-->
			</div>
			<?
				$dependencies = array(); 
				$channel['theme']->asset()->writeScript('custom','
					$("#btnChannelCreate").click(function(){
						window.location.href ="'.route('channel.add',$channel["domain"]->domain).'";
					}); 
				', $dependencies); 
				$getField=\App\Model\Fields::where('status','=',0)->get(); 
				$i=0;
			?>
			<div class="group-section-content">
				<div class="section-content">
					<div class="row-pad-5">
						<div class="col-md-8">
							@if(count($postListNew))
								<div class="panel panel-dark panel-alt widget-slider">
								<div class="panel-body">
									<div id="carousel-2" class="swiper-container" data-ride="carousel">
										<!-- Wrapper for slides -->
										<div class="swiper-wrapper">
										<?
											$i=0; 
										?>
										@foreach($postListNew as $post)
										@if(!empty($post->getSlug->slug_value))
											<?
												$i++; 
												$getChannelPost=\App\Model\Channel::join('posts_join_channel','posts_join_channel.channel_id','=','channel.id')
												->where('posts_join_channel.posts_id','=',$post->id)->select('channel.*')->first(); ; 
												if($getChannelPost->domainJoinPrimary->domain->domain_primary!='default'){
													if(count($getChannelPost->domainAll)>0){
														foreach($getChannelPost->domainAll as $domain){
															if($domain->domain->domain_primary=='default'){
																$domainPrimary=$domain->domain->domain; 
															}
														}
													}else{
														$domainPrimary=$getChannelPost->domainJoinPrimary->domain->domain; 
													}
												}else{
													$domainPrimary=$getChannelPost->domainJoinPrimary->domain->domain; 
												}
											?>
										  <div class="swiper-slide @if($i==1) active @endif">
											<div class="media">
												@if(count($post->gallery)>0)<a href="{{route('channel.slug',array($domainPrimary,$post->getSlug->slug_value))}}" class="pull-left">
													@if($post->gallery[0]->media->media_storage=='youtube')
														<img src="//img.youtube.com/vi/{{$post->gallery[0]->media->media_name}}/hqdefault.jpg" data-src="" class="padding5 postMediaXs pull-left lazy" alt="" title="" >
													@elseif($post->gallery[0]->media->media_storage=='video')
													<div class="groupThumb" style="position:relative;width: 90px;float: left;">
														<span class="btnPlayVideoClickSmall"><i class="glyphicon glyphicon-play"></i></span>
														<img itemprop="image" class="padding5 postMediaXs lazy" alt="{{$post->posts_title}}" src="{{config('app.link_media').$post->gallery[0]->media->media_path.'xs/'.$post->gallery[0]->media->media_id_random.'.png'}}"/>
													</div>
													@elseif($post->gallery[0]->media->media_storage=='files')
													<img src="{!!asset('assets/img/file.jpg')!!}" class="padding5 media-object postMediaXs lazy" alt="" title="" >
													@else
														<img src="{{config('app.link_media').$post->gallery[0]->media->media_path.'xs/'.$post->gallery[0]->media->media_name}}" data-src="" class="padding5 postMediaXs lazy" alt="" title="" >
													@endif
												</a>@endif
												<div class="media-body">
												  <h2 class="media-heading"><a href="{{route('channel.slug',array($domainPrimary,$post->getSlug->slug_value))}}">{!!$post->posts_title!!}</a></h2>
												  <div>
													<small><a href="{{route('channel.home',$domainPrimary)}}"><i class="glyphicon glyphicon-link"></i> {{$domainPrimary}}</a></small>
												</div>
												<span><small><i class="glyphicon glyphicon-time"></i> {{WebService::time_request($post->posts_updated_at)}}</small> - <small><i class="fa fa-eye"></i> {{$post->posts_view}} lượt xem</small> @if(!empty($post->joinDistrict->district->id))<small><i class="glyphicon glyphicon-map-marker"></i> {!!$post->joinDistrict->district->district_name!!}</small>@endif @if(!empty($post->joinSubRegion->subRegion->id))<small><i class="glyphicon glyphicon-map-marker"></i> {!!$post->joinSubRegion->subRegion->subregions_name!!}</small>@endif</span>
												@if(!empty($post->price->posts_attribute_value))
												<div class="text-danger">
													<strong>Giá bán:  {!!WebService::price($post->price->posts_attribute_value)!!}<sup>đ</sup></strong>
												</div>
												@endif
												</div>
											</div><!-- media -->
										  </div><!-- item -->
										 @endif
										@endforeach
										  
										</div><!-- carousel-inner -->
										<!-- Controls -->
										<a class="left carousel-control carousel_control_left_2" href="#carousel-post-qc" data-slide="prev">
										  <span class="fa fa-angle-left"></span>
										</a>
										<a class="right carousel-control carousel_control_right_2" href="#carousel-post-qc" data-slide="next">
										  <span class="fa fa-angle-right"></span>
										</a>
									</div><!-- carousel -->

								</div><!-- panel-body -->
							  </div>
							@endif
							@if(count($posts)>0)
							<ul class="list-group PostlistItem">
								@foreach($posts as $post)
								@if(!empty($post->getSlug->slug_value))
									<li class="list-group-item listPost">
										@if(count($post->gallery)>0)
											<a href="{{route('channel.slug',array($channel['domainPrimary'],$post->getSlug->slug_value))}}"><img class="padding5 postMediaXs pull-left" src="{{config('app.link_media').$post->gallery[0]->media->media_path.'xs/'.$post->gallery[0]->media->media_name}}"></a>
										@endif
										<h2 class="blog-title"><a href="{{route('channel.slug',array($channel['domainPrimary'],$post->getSlug->slug_value))}}">{!!$post->posts_title!!}</a></h2>
										<span><small><i class="glyphicon glyphicon-time"></i> {{WebService::time_request($post->posts_updated_at)}}</small> - <small><i class="fa fa-eye"></i> {{$post->posts_view}} lượt xem</small> @if(!empty($post->joinDistrict->district->id))<small><i class="glyphicon glyphicon-map-marker"></i> {!!$post->joinDistrict->district->district_name!!}</small>@endif @if(!empty($post->joinSubRegion->subRegion->id))<small><i class="glyphicon glyphicon-map-marker"></i> {!!$post->joinSubRegion->subRegion->subregions_name!!}</small>@endif</span>
										@if(!empty($post->price->posts_attribute_value))
										<div class="text-danger">
											<strong>Giá bán: {!!WebService::price($post->price->posts_attribute_value)!!}<sup>đ</sup></strong>
										</div>
										@endif
									</li>
								@endif
								@endforeach
							</ul>
							<div id="loadPost" class="text-center">
								<input id="curentPage-key" class="curentPage-key" type="hidden" value="{{$posts->currentPage()}}" autocomplete="off"/>
								<input id="totalPage-key" class="totalPage-key" type="hidden" value="{{$posts->total()}}" autocomplete="off"/>
								<input id="urlPage-key" class="urlPage-key" type="hidden" value="{{route('post.list',$channel['domainPrimary'])}}" autocomplete="off"/>
								<input id="nextPage-key" class="nextPage-key" type="hidden" value="{{$posts->nextPageUrl()}}" autocomplete="off"/>
								<input id="perPage-key" class="perPage-key" type="hidden" value="{{$posts->perPage()}}" autocomplete="off"/>
								<input id="lastPage-key" class="lastPage-key" type="hidden" value="{{$posts->lastPage()}}" autocomplete="off"/>
								@if(strlen($posts->nextPageUrl())>0)
									<div class="text-center">
										<a href="{{$posts->nextPageUrl()}}" class="viewMore btn btn-xs"><i class="glyphicon glyphicon-hand-right"></i> Xem thêm...</a>
									</div>
								@endif
							</div>
							<?
								$dependencies = array(); 
								$channel['theme']->asset()->writeScript('morePost', '
									jQuery(document).ready(function(){
									"use strict"; 
									$("#loadPost .viewMore").click(function(){
										var curentPage=parseInt($("#loadPost #curentPage-key").val()); 
										var lastPage=parseInt($("#loadPost #lastPage-key").val()); 
										var pageUrl=$("#loadPost #urlPage-key").val(); 
										var page_int=curentPage+1;
										if(page_int<=lastPage){
											$("#loadPost .viewMore").css("position","relative"); 
											$.ajax({
												type: "GET",
												url: pageUrl+"?page="+page_int,
												dataType: "html",
												contentType: "text/html",
												beforeSend: function() {
													$("#loadPost .viewMore").append("<div id=\"preloaderInBox\"><div id=\"status\"><i class=\"fa fa-spinner fa-spin\"></i></div></div>"); 
												},
												success: function(data) {
													$("#loadPost #curentPage-key").val(page_int); 
													$(data).find(".PostlistItem").ready(function() {
														var content_ajax = $(data).find(".PostlistItem").html();
														$(".PostlistItem").append(content_ajax); 
														$("#loadPost .viewMore #preloaderInBox").remove(); 
													});
												}
											});
										}else{
											$("#loadPost .viewMore").addClass("hidden");
										}
										return false; 
									}); 
								});
								', $dependencies);
							?>
							@endif
						</div>
						<div class="col-md-4">
							<div class="form-group">
								<div class="fb-page" data-href="https://www.facebook.com/cungcap.net/" data-tabs="messages" data-height="300" data-small-header="false" data-adapt-container-width="true" data-hide-cover="false" data-show-facepile="true"><blockquote cite="https://www.facebook.com/cungcap.net/" class="fb-xfbml-parse-ignore"><a href="https://www.facebook.com/cungcap.net/">Cung cấp</a></blockquote></div>
							</div>
							<div class="panel panel-default panel-alt widget-messaging">
								<div class="panel-heading">
									<div class="panel-title">{{$getChannel->total()}} Kênh mới</div>
								</div>
								<div class="panel-body">
									@if(count($getChannel)>0)
										<ul class="channelList">
										@foreach($getChannel as $subChannel)
											<?
												if($subChannel->domainJoinPrimary->domain->domain_primary!='default'){
													if(count($subChannel->domainAll)>0){
														foreach($subChannel->domainAll as $domain){
															if($domain->domain->domain_primary=='default'){
																$domainPrimary=$domain->domain->domain; 
															}
														}
													}else{
														$domainPrimary=$subChannel->domainJoinPrimary->domain->domain; 
													}
												}else{
													$domainPrimary=$subChannel->domainJoinPrimary->domain->domain; 
												}
											?>
											<li>
												@if(!empty($subChannel->channelAttributeLogo->media->media_name))<a class="pull-left" href="{{route('channel.home',$domainPrimary)}}">
												  <img class="media-object channel-thumb" src="{{config('app.link_media').$subChannel->channelAttributeLogo->media->media_path.'xs/'.$subChannel->channelAttributeLogo->media->media_name}}" alt="">
												</a>@endif
												<h4 class="sender">
												  <a href="{{route('channel.home',$domainPrimary)}}">{{$subChannel->channel_name}}</a>
												</h4>
												<p><small><a href="{{route('channel.home',$domainPrimary)}}"><i class="glyphicon glyphicon-link"></i> {{$domainPrimary}}</a></small></p> 
												<p><small class="text-muted"><i class="glyphicon glyphicon-time"></i> {{WebService::time_request($subChannel->channel_updated_at)}} - <span class="text-danger">{{$subChannel->channel_view}} lượt xem</span></small></p>
											</li>
										@endforeach
										</ul>
									@endif
								</div>
								<div id="loadChannel" class="text-center">
									<input id="curentPage-key" class="curentPage-key" type="hidden" value="{{$getChannel->currentPage()}}" autocomplete="off"/>
									<input id="totalPage-key" class="totalPage-key" type="hidden" value="{{$getChannel->total()}}" autocomplete="off"/>
									<input id="urlPage-key" class="urlPage-key" type="hidden" value="{{route('channel.list',$channel['domainPrimary'])}}" autocomplete="off"/>
									<input id="nextPage-key" class="nextPage-key" type="hidden" value="{{$getChannel->nextPageUrl()}}" autocomplete="off"/>
									<input id="perPage-key" class="perPage-key" type="hidden" value="{{$getChannel->perPage()}}" autocomplete="off"/>
									<input id="lastPage-key" class="lastPage-key" type="hidden" value="{{$getChannel->lastPage()}}" autocomplete="off"/>
									@if(strlen($getChannel->nextPageUrl())>0)
										<div class="panel-body text-center">
											<a href="{{$getChannel->nextPageUrl()}}" class="viewMore btn btn-xs"><i class="glyphicon glyphicon-hand-right"></i> Xem thêm...</a>
										</div>
									@endif
								</div>
								<?
									$dependencies = array(); 
									$channel['theme']->asset()->writeScript('moreChannel', '
										jQuery(document).ready(function(){
										"use strict"; 
										$("#loadChannel .viewMore").click(function(){
											var curentPage=parseInt($("#loadChannel #curentPage-key").val()); 
											var lastPage=parseInt($("#loadChannel #lastPage-key").val()); 
											var pageUrl=$("#loadChannel #urlPage-key").val(); 
											var page_int=curentPage+1;
											if(page_int<=lastPage){
												$("#loadChannel .viewMore").css("position","relative"); 
												$.ajax({
													type: "GET",
													url: pageUrl+"?page="+page_int,
													dataType: "html",
													contentType: "text/html",
													beforeSend: function() {
														$("#loadChannel .viewMore").append("<div id=\"preloaderInBox\"><div id=\"status\"><i class=\"fa fa-spinner fa-spin\"></i></div></div>"); 
													},
													success: function(data) {
														$("#loadChannel #curentPage-key").val(page_int); 
														$(data).find(".channelList").ready(function() {
															var content_ajax = $(data).find(".channelList").html();
															$(".channelList").append(content_ajax); 
															$("#loadChannel .viewMore #preloaderInBox").remove(); 
														});
													}
												});
											}else{
												$("#loadChannel .viewMore").addClass("hidden");
											}
											return false; 
										}); 
									});
									', $dependencies);
								?>
							</div>
						</div>
					</div>
				</div>
			</div>
		@else
			@if(count($channel['info']->joinCategory)>0 && $channel['totalPosts']>0)
			<div class="group-section-content">
				<div class="section-content">
					@foreach($channel['info']->joinCategory as $joinCategory)
						<?
							if(!empty($joinCategory->category->options->attribute_value)){
								$options=json_decode($joinCategory->category->options->attribute_value); 
							}else{
								$options=null; 
							}
						?>
						@if($options!=null && !empty($options->hiddenHomeCategory) && $options->hiddenHomeCategory=='checked')
						@else
							@if($joinCategory->category->parent_id==0)
									<? 
										$categoryId=[]; 
										array_push($categoryId, $joinCategory->category->id); 
									?>
									@if(count($joinCategory->category->children)>0)
										@foreach($joinCategory->category->children as $catChild) 
											<?
												array_push($categoryId, $catChild->id); 
												if(count($catChild->children)>0){
													foreach($catChild->children as $subChild){
														array_push($categoryId, $subChild->id); 
													}
												}
											?>
										@endforeach
									@endif
									<?
										$getPost=\App\Model\Posts::where('posts.posts_status','=','active')
											->join('posts_join_category','posts_join_category.posts_id','=','posts.id')
											->whereIn('posts_join_category.category_id',$categoryId)
											->join('posts_attribute','posts_attribute.posts_parent_id','=','posts.id')
											->where('posts_attribute.posts_attribute_type','=','gallery')
											->groupBy('posts.id')
											->orderBy('posts.posts_updated_at','desc')
											->select('posts.*')
											->get(); 
									?>
									@if(count($getPost)>0)
										<div class="panel panel-primary panel-program">
											<div class="panel-heading heading-program dropdown">
												<h3 class="panel-title categoryParentTitle"><a href="{{route('channel.slug',array($channel['domain']->domain,$joinCategory->category->getSlug->slug_value))}}"><i class="glyphicon glyphicon-book"></i> {!!$joinCategory->category->category_name!!}</a></h3> 
												@if(count($joinCategory->category->children)>0)
													<small>
														<a href="#" class="dropdown-toggle" data-toggle="dropdown">Xem thêm <span class="fa fa-angle-down"></span></a>
														<ul class="dropdown-menu nopadding">
															<a class="list-group-item" href="{{route('channel.slug',array($channel['domain']->domain,$joinCategory->category->getSlug->slug_value))}}"><i class="glyphicon glyphicon-list"></i> Xem tất cả</a>
															@foreach($joinCategory->category->children as $catChild) 
																@if(count($catChild->postsJoinParent)>0) 
																	<a class="list-group-item" href="{{route('channel.slug',array($channel['domain']->domain,$catChild->getSlug->slug_value))}}"><i class="glyphicon glyphicon-folder-open"></i> {!!$catChild->category_name!!}</a>
																@endif 
																@if(count($catChild->children)>0) 
																	@foreach($catChild->children as $subChild) 
																		@if(count($subChild->postsJoinParent)>0) 
																			<a class="list-group-item" href="{{route('channel.slug',array($channel['domain']->domain,$subChild->getSlug->slug_value))}}"><i class="glyphicon glyphicon-folder-open"></i> {!!$subChild->category_name!!}</a>
																		@endif
																	@endforeach
																@endif
															@endforeach
														</ul>
													</small>
												@endif
											</div>
											<div class="panel-body">
												<div class="row">
													@if(count($getPost)==1 && !empty($getPost[0]->getSlug->slug_value))
														<?
															if(!empty($getPost[0]->options->posts_attribute_value)){
																$options=json_decode($getPost[0]->options->posts_attribute_value); 
															}else{
																$options=null; 
															}
														?>
														@if($options!=null && !empty($options->viewFullScreen) && $options->viewFullScreen=='checked')
														@else
														<div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 postOne">
															<a class="image img-thumbnail" href="{{route('channel.slug',array($channel['domain']->domain,$getPost[0]->getSlug->slug_value))}}">
															@if($getPost[0]->gallery[0]->media->media_storage=='youtube')
																<img src="//img.youtube.com/vi/{{$getPost[0]->gallery[0]->media->media_name}}/hqdefault.jpg" class="img-responsive imgThumb" alt="{!!$getPost[0]->posts_title!!}" title="" >
															@elseif($getPost[0]->gallery[0]->media->media_storage=='video')
																<div class="groupThumb">
																	<span class="btnPlayVideoClick"><i class="glyphicon glyphicon-play"></i></span>
																	<img itemprop="image" class="img-responsive imgThumb" alt="{{$getPost[0]->posts_title}}" src="{{config('app.link_media').$getPost[0]->gallery[0]->media->media_path.'thumb/'.$getPost[0]->gallery[0]->media->media_id_random.'.png'}}"/>
																</div>
															@elseif($getPost[0]->gallery[0]->media->media_storage=='files')
																<img src="{!!asset('assets/img/file.jpg')!!}" class="img-responsive imgThumb" alt="{!!$getPost[0]->posts_title!!}" title="" >
															@else
																<img src="{{config('app.link_media').$getPost[0]->gallery[0]->media->media_path.'thumb/'.$getPost[0]->gallery[0]->media->media_name}}" class="img-responsive imgThumb" alt="{!!$getPost[0]->posts_title!!}" title="" >
															@endif
															</a>
															<div class="attribute-2 mb5">
																<small><span class="time-update"><i class="glyphicon glyphicon-time"></i> {!!WebService::time_request($getPost[0]->posts_updated_at)!!}</span> 
																<span class="author"><i class="glyphicon glyphicon-user"></i> {!!$getPost[0]->author->user->name!!}</span></small> 
															</div>
															<div class="timeline-btns">
																<div class="pull-left">
																	<a href="" class="tooltips likeUp text-muted likeUp_{{$getPost[0]->id}} @if(Auth::check())@foreach($getPost[0]->like as $like) @if($like->user_id==Auth::user()->id) text-success @endif @endforeach @endif" data-id="{{$getPost[0]->id}}" data-toggle="tooltip" title="" data-original-title="Thích"><i class="glyphicon glyphicon-thumbs-up"></i> <span class="countLike_{{$getPost[0]->id}}">{{count($getPost[0]->like)}}</span></a>
																	<a href="" class="tooltips likeDown text-muted likeDown_{{$getPost[0]->id}} @if(Auth::check())@foreach($getPost[0]->unLike as $like) @if($like->user_id==Auth::user()->id) text-danger @endif @endforeach @endif" data-id="{{$getPost[0]->id}}" data-toggle="tooltip" title="" data-original-title="Không thích"><i class="glyphicon glyphicon-thumbs-down"></i> <span class="countLikeDown_{{$getPost[0]->id}}">{{count($getPost[0]->unlike)}}</span></a>
																	<a href="" class="tooltips text-muted" data-toggle="tooltip" title="" data-original-title="Add Comment"><i class="glyphicon glyphicon-comment"></i></a>
																	<a href="" class="tooltips btnShare text-muted"  data-title="{!!$getPost[0]->posts_title!!}" data-image="{{$getPost[0]->gallery[0]->media->media_url_thumb}}" data-url="{{route('channel.slug',array($channel['domain']->domain,$getPost[0]->getSlug->slug_value))}}" data-toggle="tooltip" title="" data-original-title="Share"><i class="glyphicon glyphicon-share"></i></a>
																</div>
																<div class="pull-right">
																	<small class="text-muted text-danger"><strong>{{$getPost[0]->posts_view}} lượt xem</strong></small>
																</div>
															</div>
														</div>
														<div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
															<h2 class="blog-title-large"><a class="title" href="{{route('channel.slug',array($channel['domain']->domain,$getPost[0]->getSlug->slug_value))}}">{!!$getPost[0]->posts_title!!}</a></h2>
															@if(!empty($getPost[0]->posts_description))
																<div class="form-group">
																	<?
																		$postContent=html_entity_decode($getPost[0]->posts_description); 
																		$postContent=preg_replace('/(<p[^>]*>)(.*?)(<\/p>)/i', '$2<p>', $postContent);
																		$postContent=WebService::limit_string(strip_tags($postContent,"<p><br>"), $limit = 500); 
																		$postContent=str_replace('????', '', $postContent);
																		
																	?>
																	{!!$postContent!!} <a href="{{route('channel.slug',array($channel['domain']->domain,$getPost[0]->getSlug->slug_value))}}"><i class="glyphicon glyphicon-hand-right"></i> Xem thêm</a>
																</div>
															@endif
														</div>
														@endif
													@else
														@foreach($getPost->take(6)->chunk(3) as $chunk)
															<div class="row">
																@foreach($chunk as $post)
																	{!!Theme::partial('listPost', array('post' => $post))!!}
																@endforeach
															</div>
														@endforeach
													@endif
												</div>
											</div>
											<div class="panel-footer text-center">
												<a class="" href="{{route('channel.slug',array($channel['domain']->domain,$joinCategory->category->getSlug->slug_value))}}"><i class="glyphicon glyphicon-hand-right"></i> Xem tất cả</a>
											</div>
										</div>
									@endif
							@endif
						@endif
					@endforeach
				</div>
			</div>
			@else
			<div class="section">
				<div class="panel panel-default" style="margin-top:15px;">
					<div class="panel-body">
						<h4 class="text-center">Website chưa cập nhật thông tin</h4>
						<div class="text-center"><a href="{{route('post.add',$channel['domain']->domain)}}" class="btn btn-success"><i class="glyphicon glyphicon-edit"></i> Đăng bài</a></div>
					</div>
				</div>
			</div>
			@endif
		@endif
	</div>

</div><!-- mainpanel -->
</section>
<?
	$dependencies = array(); 
	$channel['theme']->asset()->writeScript('loadLazy','
		$(function() {
			$(".lazy").lazy();
		}); 
		var swiper = new Swiper(".swiper-container", {
			navigation: {
				nextEl: ".carousel_control_right",
				prevEl: ".carousel_control_left",
			},
		});
		var swiper = new Swiper("#carousel-2", {
			navigation: {
				nextEl: ".carousel_control_right_2",
				prevEl: ".carousel_control_left_2",
			},
		});
	', $dependencies);
?>